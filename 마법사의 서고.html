<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcane Archive - ì „ì„¤ì˜ ëŒ€ë„ì„œê´€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Nanum+Brush+Script&display=swap');

        :root {
            --ancient-gold: #c5a059;
            --stone-medium: #1a1a1f;
            --stone-dark: #0a0a0c;
            --leather-rich: #3d2b1f;
            --parchment: #f2e8cf;
        }

        body {
            font-family: 'Noto Serif KR', serif;
            background: radial-gradient(circle at center, #1a1a24 0%, #08080a 100%);
            color: #e2e2e2;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* 1. ë°°ê²½ ê±°ëŒ€ ì±… ë”ë¯¸ */
        .library-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            opacity: 0.5;
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            padding: 0;
            pointer-events: none;
        }

        .book-stack {
            width: 130px;
            display: flex;
            flex-direction: column-reverse;
            margin: 0 -20px; 
        }

        .bg-book {
            height: 12px;
            margin-bottom: 2px;
            background: #1e1e24;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            border-left: 8px solid rgba(0,0,0,0.5); 
            width: 100%;
            border-radius: 1px;
        }

        /* 2. ê³ ëŒ€ ë„ì„œê´€ ì±„ê´‘ ë° ë§ˆë²• íš¨ê³¼ */
        .god-rays {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% -5%, rgba(197, 160, 89, 0.25) 0%, transparent 85%);
            pointer-events: none;
            z-index: 1;
        }

        .magic-dust {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            background-image: radial-gradient(circle, #fff 1px, transparent 1px);
            background-size: 100px 100px;
            opacity: 0.1;
            animation: moveDust 45s linear infinite;
            z-index: 0;
        }

        @keyframes moveDust {
            from { background-position: 0 0; }
            to { background-position: 1000px 1000px; }
        }

        /* 3. 3ë‹¨ ì„ ë°˜ ë ˆì´ì•„ì›ƒ */
        .shelf-container {
            display: flex;
            flex-direction: column;
            gap: 40px;
            margin-bottom: 80px;
        }

        .shelf-row {
            position: relative;
            padding: 0 20px;
        }

        .books-wrapper {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 6px;
            min-height: 240px;
            padding-bottom: 2px;
            flex-wrap: nowrap;
            overflow-x: visible;
        }

        .stone-stair {
            height: 28px;
            background: linear-gradient(to bottom, #32323a, #08080a);
            border-radius: 2px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            width: 100%;
            border-top: 1px solid rgba(197, 160, 89, 0.2);
        }

        /* 4. ë§ˆë„ì„œ(Grimoire) ë””ìì¸ */
        .grimoire {
            /* ë„ˆë¹„ëŠ” JSì—ì„œ ë™ì ìœ¼ë¡œ ì„¤ì • */
            height: 190px;
            position: relative;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
            transform-style: preserve-3d;
            border-radius: 3px 6px 6px 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            font-family: 'Nanum Brush Script', cursive;
            font-size: 1.2rem;
            color: rgba(255,255,255,0.9);
            box-shadow: -10px 10px 25px rgba(0,0,0,0.7);
            border-left: 6px solid rgba(0,0,0,0.3);
            flex-shrink: 0;
            text-align: center;
        }

        .grimoire::before {
            content: '';
            position: absolute;
            left: 0; right: 0; top: 0; bottom: 0;
            background: linear-gradient(to bottom, 
                transparent 15%, rgba(0,0,0,0.3) 15.5%, rgba(0,0,0,0.3) 17%, transparent 17.5%,
                transparent 45%, rgba(0,0,0,0.4) 45.5%, rgba(0,0,0,0.4) 47%, transparent 47.5%,
                transparent 80%, rgba(0,0,0,0.4) 80.5%, rgba(0,0,0,0.4) 82%, transparent 82.5%
            );
        }

        .grimoire-decoration {
            position: absolute;
            top: 10px; bottom: 10px; left: 10px; right: 10px;
            border: 1px solid rgba(197, 160, 89, 0.3);
            pointer-events: none;
        }

        .grimoire:hover {
            transform: translateY(-30px) rotateY(-15deg) scale(1.1);
            filter: brightness(1.2);
            box-shadow: 20px 20px 40px rgba(0,0,0,0.9);
            z-index: 50;
        }

        .grimoire-add {
            width: 60px;
            background: rgba(197, 160, 89, 0.05);
            border: 2px dashed rgba(197, 160, 89, 0.2);
            color: var(--ancient-gold);
            font-family: 'serif';
            font-size: 1.8rem;
            writing-mode: horizontal-tb;
            box-shadow: none;
        }

        /* 5. 3D ë¶ ëª¨ë‹¬ */
        .book-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            backdrop-filter: blur(25px);
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            perspective: 2000px;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .open-book {
            width: 100%;
            max-width: 900px;
            height: 80vh;
            max-height: 600px;
            display: flex;
            position: relative;
            transform-style: preserve-3d;
            animation: bookUnfold 0.8s cubic-bezier(0.19, 1, 0.22, 1) forwards;
            background-image: url('https://www.transparenttextures.com/patterns/parchment.png');
        }

        @keyframes bookUnfold {
            0% { transform: scale(0.8) rotateY(-45deg); opacity: 0; }
            100% { transform: scale(1) rotateY(0deg); opacity: 1; }
        }

        .book-page {
            flex: 1;
            background: #e8dec9;
            color: #2d241e;
            padding: 25px;
            position: relative;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        .page-left {
            border-radius: 10px 0 0 10px;
            border-right: 1px solid rgba(0,0,0,0.1);
            background-image: linear-gradient(to right, #d4c4a8, #e8dec9 15%);
        }

        .page-right {
            border-radius: 0 10px 10px 0;
            background-image: linear-gradient(to left, #d4c4a8, #e8dec9 15%);
        }

        .book-binding {
            position: absolute;
            left: 50%; top: 0; bottom: 0;
            width: 30px;
            background: linear-gradient(to right, rgba(0,0,0,0.2), rgba(0,0,0,0.05) 50%, rgba(0,0,0,0.2));
            transform: translateX(-50%);
            z-index: 10;
        }

        /* 6. ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 768px) {
            .open-book {
                flex-direction: column;
                height: 90vh;
                max-height: none;
            }
            .book-binding {
                width: 100%;
                height: 20px;
                left: 0; top: 50%;
                transform: translateY(-50%);
                background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.02) 50%, rgba(0,0,0,0.1));
            }
            .page-left { border-radius: 10px 10px 0 0; border-right: none; border-bottom: 1px solid rgba(0,0,0,0.1); }
            .page-right { border-radius: 0 0 10px 10px; }
            .grimoire { height: 160px; font-size: 1rem; }
            .books-wrapper { gap: 5px; }
        }

        .gold-btn {
            background: rgba(197, 160, 89, 0.1);
            border: 1px solid var(--ancient-gold);
            color: var(--ancient-gold);
            padding: 8px 16px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .gold-btn:hover:not(:disabled) {
            background: var(--ancient-gold);
            color: #000;
            box-shadow: 0 0 20px var(--ancient-gold);
        }

        .gold-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .mana-input {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(54, 36, 26, 0.2);
            border-radius: 4px;
            color: #2d241e;
            padding: 10px;
            width: 100%;
            font-family: 'serif';
            resize: none;
            outline: none;
        }

        /* ì‘í’ˆ ì¶”ê°€ ëª¨ë‹¬ */
        .modal-blur {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            backdrop-filter: blur(20px);
            background: rgba(0,0,0,0.85);
            z-index: 1100;
            justify-content: center;
            align-items: center;
        }

        .ancient-slab {
            background: rgba(20, 20, 28, 0.95);
            border: 1px solid var(--ancient-gold);
            box-shadow: 0 30px 60px rgba(0,0,0,1);
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="p-4 md:p-10 pt-10">
    <div class="library-bg" id="bg-stacks"></div>
    <div class="god-rays"></div>
    <div class="magic-dust"></div>

    <main class="max-w-6xl mx-auto relative z-10">
        <!-- ìƒë‹¨ ì •ë³´ í—¤ë” -->
        <div class="flex flex-wrap items-center justify-between gap-6 mb-12 px-4">
            <div class="flex items-center gap-6">
                <span class="text-4xl opacity-50">ğŸ“œ</span>
                <h3 class="text-xl md:text-2xl font-bold tracking-[0.2em] text-stone-400 uppercase">The Eternal Records</h3>
                <span id="book-count" class="text-[10px] bg-stone-900 text-stone-500 px-3 py-1 border border-stone-800 font-bold uppercase tracking-widest">Volumes: 0</span>
            </div>
            <button onclick="getAiRecommendation()" class="gold-btn text-[10px] tracking-widest px-4 py-2">
                ğŸ”® ìš´ëª…ì˜ ê³„ì‹œ
            </button>
        </div>

        <!-- 3ë‹¨ ì„œì¬ ì„ ë°˜ êµ¬ì—­ -->
        <div class="shelf-container">
            <div class="shelf-row">
                <div id="shelf-1" class="books-wrapper"></div>
                <div class="stone-stair"></div>
            </div>
            <div class="shelf-row">
                <div id="shelf-2" class="books-wrapper"></div>
                <div class="stone-stair"></div>
            </div>
            <div class="shelf-row">
                <div id="shelf-3" class="books-wrapper">
                    <div class="grimoire grimoire-add" onclick="openConjureModal()" title="ìƒˆë¡œìš´ ë§ˆë²• ê¸°ë¡ ì—°ì„±">+</div>
                </div>
                <div class="stone-stair"></div>
            </div>
        </div>
    </main>

    <!-- ë§ˆë„ì„œ í¼ì¹˜ê¸° ëª¨ë‹¬ -->
    <div id="book-modal" class="book-overlay" onclick="closeGrimoire()">
        <div class="open-book" onclick="event.stopPropagation()">
            <div class="book-binding"></div>
            <div class="book-page page-left flex flex-col">
                <h3 id="book-title" class="text-2xl md:text-3xl font-bold mb-6 font-serif text-[#36241a] border-b border-[#36241a]/10 pb-4">ì‘í’ˆëª…</h3>
                <div class="flex-1 flex flex-col justify-center">
                    <div class="text-[10px] uppercase tracking-[0.2em] text-[#36241a]/40 font-bold mb-4 italic">The Sealed Question</div>
                    <div id="q-text" class="text-lg font-bold border-l-4 border-[#c5a059]/50 pl-6 py-2 italic text-[#4a342e]">ì§ˆë¬¸ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
                </div>
                <div class="mt-8 flex items-center justify-between">
                    <div class="flex gap-2">
                        <button onclick="prevQuestion()" class="p-2 border border-[#36241a]/20 hover:bg-[#36241a]/5 rounded">â—€</button>
                        <span id="q-index" class="text-[10px] font-bold text-[#36241a]/50 flex items-center px-1">1 / 1</span>
                        <button onclick="nextQuestion()" class="p-2 border border-[#36241a]/20 hover:bg-[#36241a]/5 rounded">â–¶</button>
                    </div>
                    <button onclick="conjureNewQuestion()" class="gold-btn text-[10px] px-3 py-2">âœ¨ ìƒˆ ì‚¬ìœ  ì—°ì„±</button>
                </div>
            </div>
            <div class="book-page page-right flex flex-col">
                <div class="absolute top-4 right-6 text-3xl cursor-pointer opacity-30 hover:opacity-100" onclick="closeGrimoire()">Ã—</div>
                <div class="flex-1 flex flex-col mt-8">
                    <div class="text-[10px] uppercase tracking-[0.2em] text-[#36241a]/40 font-bold mb-4 italic">My Arcane Record</div>
                    <textarea id="a-input" class="mana-input flex-1" placeholder="ë‹¹ì‹ ì˜ í†µì°°ì„ ì´ê³³ì— ë´‰ì¸í•˜ì‹­ì‹œì˜¤..."></textarea>
                </div>
                <div class="mt-6 flex justify-end gap-3 items-center">
                    <button onclick="saveCurrentAnswer()" class="gold-btn text-[10px] px-6 py-2">ë´‰ì¸ ì™„ë£Œ</button>
                </div>
                <div class="mt-4 pt-4 border-t border-[#36241a]/5 flex justify-between items-center text-[9px] text-[#36241a]/40 font-bold tracking-[0.2em] uppercase">
                    <span>Fragment #ARC-9</span>
                    <span id="m-date">FEB 15, 2026</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‘í’ˆ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="conjure-modal" class="modal-blur" onclick="closeConjureModal()">
        <div class="ancient-slab" onclick="event.stopPropagation()">
            <h3 class="text-xl font-bold text-yellow-600 mb-6 tracking-widest uppercase">Seal New Record</h3>
            <input type="text" id="new-anime-title" class="w-full bg-black/40 border border-stone-800 px-4 py-4 focus:outline-none focus:border-yellow-900/50 text-stone-200 mb-8 font-serif" placeholder="ì‘í’ˆëª… ì…ë ¥...">
            <div class="flex gap-4">
                <button onclick="saveNewRecord()" class="gold-btn flex-1 py-3 text-xs tracking-widest">ì—°ì„± ì™„ë£Œ</button>
                <button onclick="closeConjureModal()" class="flex-1 py-3 bg-stone-900 text-stone-600 border border-stone-800 text-xs tracking-widest uppercase">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ìš´ëª…ì˜ ê³„ì‹œ íŒì—… -->
    <div id="recommendation-overlay" class="modal-blur" onclick="closeRecommendation()">
        <div class="ancient-slab" onclick="event.stopPropagation()">
            <div class="inline-block px-8 py-1 rounded-sm border border-yellow-800 text-yellow-600 text-[9px] mb-8 font-bold tracking-[0.4em] uppercase">Grand Revelation ğŸ”®</div>
            <p id="recommendation-text" class="text-xl font-bold leading-relaxed text-stone-100 italic" style="font-family: 'serif';"></p>
            <button onclick="closeRecommendation()" class="gold-btn px-10 py-3 mt-10 text-xs tracking-widest">í™•ì¸</button>
        </div>
    </div>

    <script>
        const apiKey = "";
        
        // 20ê¶Œì˜ ì´ˆê¸° ë°ì´í„°
        let archiveData = {
            'ì¥ì†¡ì˜ í”„ë¦¬ë Œ': [{ q: "í˜ë©œê³¼ì˜ 10ë…„, ê·¸ ì§§ì§€ë§Œ ì˜ì›í•œ ì‹œê°„ì˜ ì¡°ê°ë“¤ ì¤‘ ë‹¹ì‹ ì´ ê°€ì¥ ë´‰ì¸í•´ë‘ê³  ì‹¶ì€ ê¸°ì–µì€ ë¬´ì—‡ì¸ê°€ìš”?", a: "" }],
            'ê·€ë©¸ì˜ ì¹¼ë‚ ': [{ q: "ë Œê³ ì¿  ì¿„ì¥¬ë¡œê°€ ë‚¨ê¸´ 'ë§ˆìŒì„ ë¶ˆíƒœì›Œë¼'ë¼ëŠ” ë§ì´ ë‹¹ì‹ ì˜ ì‚¶ì— ì–´ë–¤ ë¶ˆê½ƒì„ ì§€íˆë‚˜ìš”?", a: "" }],
            'ì£¼ìˆ íšŒì „': [{ q: "ë§Œì•½ ë‹¹ì‹ ì´ 'ì˜ì—­ ì „ê°œ'ë¥¼ í•  ìˆ˜ ìˆë‹¤ë©´, ê·¸ ê³µê°„ì€ ë‹¹ì‹ ì˜ ì–´ë–¤ ë‚´ë©´ì„ ë¹„ì¶”ê³  ìˆì„ê¹Œìš”?", a: "" }],
            'ìµœì• ì˜ ì•„ì´': [{ q: "ê±°ì§“ë§ì€ ê°€ì¥ ì§€ë…í•œ ì‚¬ë‘ì˜ í˜•íƒœë¼ê³  í•©ë‹ˆë‹¤. ë‹¹ì‹ ì´ ìƒê°í•˜ëŠ” ì§„ì‹¤í•œ ì‚¬ë‘ì˜ ëª¨ìŠµì€ ë¬´ì—‡ì¸ê°€ìš”?", a: "" }],
            'í•˜ì´í!!': [{ q: "ì½”íŠ¸ ìœ„ì—ì„œ ê³µì„ ë–¨ì–´ëœ¨ë¦¬ì§€ ì•Šê¸° ìœ„í•´ ì´ì–´ì§€ëŠ” ì—°ê²°ì˜ í˜. ë‹¹ì‹ ì˜ ì‚¶ì—ì„œ ê°€ì¥ ì†Œì¤‘í•œ 'ì—°ê²°'ì€ ë¬´ì—‡ì¸ê°€ìš”?", a: "" }],
            'ìŠ¤íŒŒì´ íŒ¨ë°€ë¦¬': [{ q: "ê°€ì§œ ê°€ì¡±ì´ ë§Œë“  ì§„ì§œ ë”°ëœ»í•¨. ë‹¹ì‹ ì—ê²Œ 'ê°€ì¡±'ì´ë¼ëŠ” ì¡´ì¬ì˜ ì •ì˜ëŠ” ë¬´ì—‡ì…ë‹ˆê¹Œ?", a: "" }],
            'ì¸í„°ìŠ¤í…”ë¼': [{ q: "ì‚¬ë‘ì€ ì‹œê³µê°„ì„ ì´ˆì›”í•˜ëŠ” ìœ ì¼í•œ ê²ƒì´ë¼ê³  í•©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë¬´ì—‡ì„ ìœ„í•´ ì‹œê³µê°„ì„ ê±´ë„ˆê² ìŠµë‹ˆê¹Œ?", a: "" }],
            'ê¸°ìƒì¶©': [{ q: "ëƒ„ìƒˆëŠ” ì„ ì„ ë„˜ëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤. ë‹¹ì‹ ì´ ì‚¶ì—ì„œ ì ˆëŒ€ë¡œ ë„˜ì§€ ì•Šìœ¼ë ¤ í•˜ëŠ” 'ì„ 'ì€ ì–´ë””ì¸ê°€ìš”?", a: "" }],
            'ë„ê¹¨ë¹„': [{ q: "ë¶ˆë©¸ì˜ ì‚¶ ì†ì—ì„œ ì˜¤ì§ í•œ ì‚¬ëŒë§Œì´ ëë‚¼ ìˆ˜ ìˆëŠ” ì €ì£¼. ë‹¹ì‹ ì—ê²Œ 'ìš´ëª…'ì´ë€ êµ¬ì›ì¸ê°€ìš”, ì†ë°•ì¸ê°€ìš”?", a: "" }],
            'í•´ë¦¬ í¬í„°': [{ q: "í˜¸ê·¸ì™€íŠ¸ ì…í•™í†µì§€ì„œë¥¼ ê¸°ë‹¤ë¦¬ë˜ ì–´ë¦° ì‹œì ˆì˜ ë‹¹ì‹ ì—ê²Œ, ì§€ê¸ˆì˜ ë‹¹ì‹ ì€ ì–´ë–¤ ë§ˆë²•ì„ ë³´ì—¬ì£¼ê³  ì‹¶ë‚˜ìš”?", a: "" }],
            'ë¯¸ìŠ¤í„° ì…˜ìƒ¤ì¸': [{ q: "ê³ ê·€í•˜ê³  ìœ„íƒœë¡œìš´ ì†Œí’ ê°™ì•˜ë˜ ì‚¶. ë‹¹ì‹ ì€ ì–´ë–¤ ì´ë¦„ì„ ë‚¨ê¸°ê³  ì´ ì„¸ìƒì„ ì†Œí’ì²˜ëŸ¼ ë– ë‚˜ê³  ì‹¶ë‚˜ìš”?", a: "" }],
            'ì§„ê²©ì˜ ê±°ì¸': [{ q: "ë²½ ë„ˆë¨¸ì— ììœ ê°€ ìˆë‹¤ê³  ë¯¿ì—ˆì§€ë§Œ ë” í° ë¹„ê·¹ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì´ ìƒê°í•˜ëŠ” ì§„ì •í•œ 'ììœ 'ë€ ë¬´ì—‡ì¸ê°€ìš”?", a: "" }],
            'ë” ê¸€ë¡œë¦¬': [{ q: "ì°¨ê°€ìš´ ë³µìˆ˜ ëì— ë‚¨ì€ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”? ìš©ì„œì™€ ë§ê° ì¤‘ ë‹¹ì‹ ì€ ë¬´ì—‡ì„ ì„ íƒí•˜ê² ìŠµë‹ˆê¹Œ?", a: "" }],
            'ì˜¤ì§•ì–´ ê²Œì„': [{ q: "ë²¼ë‘ ëì— ëª°ë¦° ì‚¬ëŒë“¤ ì‚¬ì´ì—ì„œ í”¼ì–´ë‚œ ì¸ê°„ì• . ë‹¹ì‹ ì´ë¼ë©´ ê·¸ ìƒí™©ì—ì„œ ì˜† ì‚¬ëŒì˜ ì†ì„ ì¡ê² ìŠµë‹ˆê¹Œ?", a: "" }],
            'ì¸ì…‰ì…˜': [{ q: "ê¿ˆì†ì˜ ê¿ˆ. ë‹¹ì‹ ì´ í˜„ì‹¤ì´ë¼ê³  ë¯¿ê³  ìˆëŠ” ì§€ê¸ˆ ì´ ìˆœê°„ì´ ëˆ„êµ°ê°€ì˜ ì„¤ê³„ëœ ê¿ˆì´ë¼ë©´ ì–´ë–¨ê¹Œìš”?", a: "" }],
            'í•˜ìš¸ì˜ ì›€ì§ì´ëŠ” ì„±': [{ q: "ë§ˆìŒì´ ë¬´ê±°ìš´ ê²ƒì€ í•˜ìš¸ì˜ ì‹¬ì¥ì„ ê°€ì¡Œê¸° ë•Œë¬¸ì¼ê¹Œìš”? ë‹¹ì‹ ì˜ ë§ˆìŒì„ ê°€ì¥ ë¬´ê²ê²Œ ë§Œë“œëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?", a: "" }],
            'ë‚˜ë£¨í† ': [{ q: "í˜¸ì¹´ê²Œë¼ëŠ” ê¿ˆì„ ìœ„í•´ í¬ê¸°í•˜ì§€ ì•Šì•˜ë˜ ì†Œë…„. ë‹¹ì‹ ì´ ì„¸ìƒì„ í–¥í•´ ì™¸ì¹˜ê³  ì‹¶ì€ ë‹¹ì‹ ë§Œì˜ 'ì¸ë„(å¿é“)'ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", a: "" }],
            'ì›í”¼ìŠ¤': [{ q: "ëŒ€ë¹„ë³´ ì›í”¼ìŠ¤ë³´ë‹¤ ì¤‘ìš”í•œ ê²ƒì€ í•¨ê»˜ í•­í•´í•˜ëŠ” ë™ë£Œì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ë°°ì— í•¨ê»˜ íƒœìš°ê³  ì‹¶ì€ ì‚¬ëŒì€ ëˆ„êµ¬ì¸ê°€ìš”?", a: "" }],
            'ë§¤íŠ¸ë¦­ìŠ¤': [{ q: "ë¹¨ê°„ ì•½ê³¼ íŒŒë€ ì•½. ê³ í†µìŠ¤ëŸ¬ìš´ ì§„ì‹¤ê³¼ ì•ˆë½í•œ ê°€ì§œ í˜„ì‹¤ ì¤‘ ë‹¹ì‹ ì˜ ì„ íƒì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?", a: "" }],
            'íƒ€ì´íƒ€ë‹‰': [{ q: "ì°¨ê°€ìš´ ë°”ë‹¤ ìœ„ì—ì„œ ë§ˆì§€ë§‰ê¹Œì§€ ì—°ì£¼ë¥¼ ë©ˆì¶”ì§€ ì•Šì•˜ë˜ ì•…ë‹¨ì²˜ëŸ¼, ë‹¹ì‹ ì€ ì‚¶ì˜ ë§ˆì§€ë§‰ì— ë¬´ì—‡ì„ í•˜ê³  ì‹¶ë‚˜ìš”?", a: "" }]
        };
        
        let currentOpenAnime = "";
        let currentQIndex = 0;

        function createBgStacks() {
            const container = document.getElementById('bg-stacks');
            if(!container) return;
            const stackCount = 14; 
            for(let i = 0; i < stackCount; i++) {
                const stack = document.createElement('div');
                stack.className = 'book-stack';
                const height = Math.floor(Math.random() * 30) + 15; 
                for(let j = 0; j < height; j++) {
                    const book = document.createElement('div');
                    book.className = 'bg-book';
                    book.style.width = (75 + Math.random() * 45) + '%';
                    const hue = 210 + Math.random() * 40;
                    book.style.backgroundColor = `hsl(${hue}, 15%, ${12 + Math.random() * 15}%)`;
                    stack.appendChild(book);
                }
                container.appendChild(stack);
            }
        }

        // ì´ˆê¸° ì„œì¬ ì±„ìš°ê¸° (3ë‹¨ ë¶„ë°°)
        function initLibrary() {
            const titles = Object.keys(archiveData);
            titles.forEach((title, index) => {
                let targetShelfId = `shelf-${(index % 3) + 1}`;
                createGrimoireElement(title, targetShelfId);
            });
            updateVolumeCount();
        }

        function createGrimoireElement(title, shelfId) {
            const shelf = document.getElementById(shelfId);
            const addButton = shelf.querySelector('.grimoire-add');
            
            const colors = ['#4e1a1a', '#1a2b4a', '#1b3b2a', '#5d4037', '#281b3d', '#1c1c1c', '#3e2723', '#2c3e50'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            const randomHeight = Math.floor(Math.random() * 50) + 170;
            const randomWidth = Math.floor(Math.random() * 40) + 45; // ë‘ê»˜ ë‹¤ì–‘í™” (45px ~ 85px)

            const newBook = document.createElement('div');
            newBook.className = 'grimoire';
            newBook.style.backgroundColor = randomColor;
            newBook.style.height = `${randomHeight}px`;
            newBook.style.width = `${randomWidth}px`;
            newBook.innerHTML = `<div class="grimoire-decoration"></div>${title}`;
            newBook.onclick = () => openGrimoire(title);

            if (addButton) shelf.insertBefore(newBook, addButton);
            else shelf.appendChild(newBook);
        }
        
        window.onload = function() {
            createBgStacks();
            initLibrary();
        };

        async function fetchGemini(prompt, systemInstruction = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: systemInstruction ? { parts: [{ text: systemInstruction }] } : undefined
            };
            try {
                const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                const res = await response.json();
                return res.candidates?.[0]?.content?.parts?.[0]?.text || "ë§ˆë ¥ì´ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤.";
            } catch (error) { return "ê²°ê³„ê°€ ë¶ˆì•ˆì •í•©ë‹ˆë‹¤."; }
        }

        function openGrimoire(title) {
            currentOpenAnime = title;
            if (!archiveData[title]) archiveData[title] = [{ q: `'${title}'ì— ëŒ€í•œ ì²« ë²ˆì§¸ ê¸°ë¡ì„ ì‹œì‘í•˜ì‹­ì‹œì˜¤.`, a: "" }];
            currentQIndex = archiveData[title].length - 1;
            document.getElementById('book-title').innerText = title;
            updatePageContent();
            document.getElementById('book-modal').style.display = 'flex';
        }

        function closeGrimoire() {
            saveCurrentAnswer();
            document.getElementById('book-modal').style.display = 'none';
        }

        function updatePageContent() {
            const history = archiveData[currentOpenAnime];
            const item = history[currentQIndex];
            document.getElementById('q-text').innerText = item.q;
            document.getElementById('a-input').value = item.a;
            document.getElementById('q-index').innerText = `${currentQIndex + 1} / ${history.length}`;
        }

        function prevQuestion() { if (currentQIndex > 0) { saveCurrentAnswer(); currentQIndex--; updatePageContent(); } }
        function nextQuestion() { if (currentQIndex < archiveData[currentOpenAnime].length - 1) { saveCurrentAnswer(); currentQIndex++; updatePageContent(); } }
        function saveCurrentAnswer() { if (currentOpenAnime && archiveData[currentOpenAnime][currentQIndex]) archiveData[currentOpenAnime][currentQIndex].a = document.getElementById('a-input').value; }

        async function conjureNewQuestion() {
            const btn = event.currentTarget;
            btn.disabled = true;
            const originalText = btn.innerText;
            btn.innerText = "ì—°ì„± ì¤‘...";
            saveCurrentAnswer();
            const prompt = `ì• ë‹ˆë©”ì´ì…˜ì´ë‚˜ ì˜í™” '${currentOpenAnime}'ì˜ ì£¼ì œ ì˜ì‹ì— ëŒ€í•´ ì² í•™ì ì´ê³  ì˜¤ë§Œí•œ ì œë¦¬ì—ì˜ ë§íˆ¬ë¡œ ì§ˆë¬¸ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ë§Œë“¤ì–´ë¼.`;
            const newQ = await fetchGemini(prompt, "ë‹¹ì‹ ì€ ì œë¦¬ì—ì…ë‹ˆë‹¤.");
            archiveData[currentOpenAnime].push({ q: newQ.trim(), a: "" });
            currentQIndex = archiveData[currentOpenAnime].length - 1;
            btn.disabled = false; btn.innerText = originalText;
            updatePageContent();
        }

        function openConjureModal() { document.getElementById('conjure-modal').style.display = 'flex'; }
        function closeConjureModal() { document.getElementById('conjure-modal').style.display = 'none'; }

        function saveNewRecord() {
            const title = document.getElementById('new-anime-title').value.trim();
            if (!title) return;
            let targetShelfId = "shelf-1";
            const s1 = document.getElementById('shelf-1').children.length;
            const s2 = document.getElementById('shelf-2').children.length;
            const s3 = document.getElementById('shelf-3').children.length;
            if (s1 <= s2 && s1 <= s3) targetShelfId = "shelf-1";
            else if (s2 <= s3) targetShelfId = "shelf-2";
            else targetShelfId = "shelf-3";
            createGrimoireElement(title, targetShelfId);
            updateVolumeCount(); closeConjureModal();
        }

        function updateVolumeCount() {
            const count = document.querySelectorAll('.grimoire:not(.grimoire-add)').length;
            document.getElementById('book-count').innerText = `Volumes: ${count}`;
        }

        async function getAiRecommendation() {
            const overlay = document.getElementById('recommendation-overlay');
            const textField = document.getElementById('recommendation-text');
            overlay.style.display = 'flex';
            textField.innerText = "ìˆ˜ì •êµ¬ìŠ¬ì„ ë“¤ì—¬ë‹¤ë³´ëŠ” ì¤‘ì´ë‹¤...";
            const books = Object.keys(archiveData).join(', ');
            const res = await fetchGemini(`ì‚¬ìš©ìì˜ ì·¨í–¥: [${books}]. ì œë¦¬ì—ë‹µê²Œ ë”± í•˜ë‚˜ì˜ ì• ë‹ˆë©”ì´ì…˜ì´ë‚˜ ì˜í™”ë¥¼ ì˜¤ë§Œí•˜ê²Œ ì¶”ì²œí•´ì¤˜.`, "ë‹¹ì‹ ì€ ì œë¦¬ì—ì…ë‹ˆë‹¤.");
            textField.innerText = res.trim();
        }
        function closeRecommendation() { document.getElementById('recommendation-overlay').style.display = 'none'; }
    </script>
</body>
</html>