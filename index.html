<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcane Archive - AI ë§ˆë²• ì„œì¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap');

        :root {
            --magic-purple: #6b46c1;
            --magic-gold: #ecc94b;
            --deep-night: #1a1b26;
        }

        body {
            font-family: 'Noto Serif KR', serif;
            background: radial-gradient(circle at center, #1e1e2e 0%, #0f0f1a 100%);
            color: #e2e8f0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* ë§ˆë²• ê°™ì€ ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ */
        .magic-dust {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            background-image: radial-gradient(circle, #fff 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.1;
            animation: moveDust 20s linear infinite;
            z-index: 0;
        }

        @keyframes moveDust {
            from { background-position: 0 0; }
            to { background-position: 500px 1000px; }
        }

        /* ì§ˆë¬¸ ì¹´ë“œ í”Œë¡œíŒ… ì• ë‹ˆë©”ì´ì…˜ */
        .floating-card {
            animation: float 4s ease-in-out infinite;
            background: rgba(30, 30, 50, 0.7);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(177, 156, 217, 0.3);
            box-shadow: 0 0 30px rgba(107, 70, 193, 0.2);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(0.5deg); }
        }

        /* 3D ì±… ë””ìì¸ */
        .grimoire {
            width: 60px;
            height: 180px;
            position: relative;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            border-radius: 4px 8px 8px 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            box-shadow: -8px 5px 15px rgba(0,0,0,0.4);
        }

        .grimoire::after {
            content: '';
            position: absolute;
            left: 8px; top: 0; bottom: 0; width: 2px;
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
        }

        .grimoire:hover {
            transform: translateY(-25px) rotateY(-15deg) scale(1.1);
            filter: brightness(1.2);
            box-shadow: 15px 15px 30px rgba(0,0,0,0.5);
            z-index: 50;
        }

        /* ì„œì¬ ì„ ë°˜ íš¨ê³¼ */
        .shelf-plate {
            height: 12px;
            background: linear-gradient(to bottom, #3e2723, #1b0a0a);
            border-radius: 4px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.6);
            position: relative;
            z-index: 10;
        }

        /* ì»¤ìŠ¤í…€ ë²„íŠ¼ */
        .magic-btn {
            transition: all 0.3s;
            background: linear-gradient(135deg, #6b46c1 0%, #44337a 100%);
            border: 1px solid rgba(236, 201, 75, 0.4);
        }

        .magic-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(236, 201, 75, 0.6);
            border-color: #ecc94b;
        }

        /* ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ */
        .modal-blur {
            display: none;
            backdrop-filter: blur(8px);
            background: rgba(0,0,0,0.8);
            transition: opacity 0.3s;
            z-index: 100;
        }

        .book-open-anim {
            animation: bookOpen 0.6s ease-out forwards;
        }

        @keyframes bookOpen {
            from { transform: scale(0.8) rotateY(-90deg); opacity: 0; }
            to { transform: scale(1) rotateY(0deg); opacity: 1; }
        }

        /* ë©”ì‹œì§€ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .notification-toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: #ecc94b;
            color: #1a1b26;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: bold;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            z-index: 200;
            display: none;
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #ecc94b;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="p-4 md:p-10">
    <div class="magic-dust"></div>
    <div id="toast" class="notification-toast"></div>

    <!-- ë¡œê³  ë° ìƒë‹¨ í—¤ë” -->
    <header class="text-center mb-12 relative z-10">
        <h1 class="text-4xl font-bold mb-2 tracking-widest text-yellow-400" style="text-shadow: 0 0 15px rgba(236, 201, 75, 0.5);">ARCANE ARCHIVE</h1>
        <p class="text-purple-300 opacity-80">ê¸°ë¡ì€ í˜ì´ ë˜ê³ , ê¸°ì–µì€ ë§ˆë²•ì´ ëœë‹¤</p>
    </header>

    <!-- ì¤‘ì•™ ì§ˆë¬¸ êµ¬ì—­ -->
    <main class="max-w-4xl mx-auto relative z-10">
        <section class="floating-card rounded-3xl p-8 mb-16 text-center">
            <div class="inline-block px-4 py-1 rounded-full border border-yellow-500/50 text-yellow-500 text-sm mb-4 font-bold tracking-widest">
                CURRENT QUEST ğŸ”®
            </div>
            <h2 id="current-question-display" class="text-2xl md:text-3xl font-bold mb-6 leading-relaxed">
                "ì¥ì†¡ì˜ í”„ë¦¬ë Œì—ì„œ ë‹¹ì‹ ì´ ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ë§ˆë²•ì€ ë¬´ì—‡ì¸ê°€ìš”?"
            </h2>
            
            <div class="flex flex-col md:flex-row gap-4 justify-center">
                <button id="gen-question-btn" onclick="generateAiQuestion()" class="magic-btn px-6 py-3 rounded-xl font-bold text-white flex items-center justify-center gap-2">
                    <span id="btn-text">âœ¨ ë§ˆë ¥ ì¶©ì „ (AI ì§ˆë¬¸ ìƒì„±)</span>
                </button>
                <button onclick="openWriteModal()" class="px-6 py-3 rounded-xl bg-purple-900/40 hover:bg-purple-800/60 text-purple-200 font-bold transition-all border border-purple-500/30 flex items-center justify-center gap-2">
                    <span>ğŸ“ ê¸°ë¡ ë´‰ì¸í•˜ê¸°</span>
                </button>
            </div>
        </section>

        <!-- ì„œì¬ ì•„ì¹´ì´ë¸Œ -->
        <section>
            <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
                <div class="flex items-center gap-3">
                    <span class="text-2xl">ğŸ›ï¸</span>
                    <h3 class="text-xl font-bold tracking-wider">ë‚˜ì˜ ê¸ˆì„œ ë³´ê´€ì†Œ</h3>
                    <span id="book-count" class="text-sm bg-purple-900/50 text-purple-300 px-3 py-1 rounded-full border border-purple-500/30">6ê¶Œì˜ ê¸°ë¡</span>
                </div>
                <button onclick="getAiRecommendation()" class="text-sm text-yellow-500 hover:text-yellow-400 font-bold border-b border-yellow-500/50 pb-1 flex items-center gap-1">
                    <span>ğŸ”® ìš´ëª…ì˜ ìˆ˜ì •êµ¬ìŠ¬ (ì¶”ì²œ ë°›ê¸°)</span>
                </button>
            </div>

            <div class="relative group">
                <!-- ì±…ë“¤ ë‚˜ì—´ -->
                <div id="bookshelf" class="flex items-end justify-start gap-3 px-6 pb-2 overflow-x-auto min-h-[250px] scrollbar-hide">
                    <!-- ê¸°ë³¸ ë°ì´í„° -->
                    <div class="grimoire bg-red-900 border-l-4 border-red-700 text-red-100" 
                         onclick="openGrimoire('ì¥ì†¡ì˜ í”„ë¦¬ë Œ', 'ê°€ì¥ ë´‰ì¸í•´ë‘ê³  ì‹¶ì€ ê¸°ì–µì€?', 'í˜ë©œê³¼ì˜ 10ë…„, ê·¸ ì§§ì§€ë§Œ ì˜ì›í•œ ì‹œê°„ì˜ ì¡°ê°ë“¤.')">í”„ë¦¬ë Œ</div>
                    
                    <div class="grimoire bg-blue-900 border-l-4 border-blue-700 text-blue-100 h-[195px]" 
                         onclick="openGrimoire('ê·€ë©¸ì˜ ì¹¼ë‚ ', 'ê°€ì¥ ëˆˆë¬¼ í˜ë ¸ë˜ ì£½ìŒì€?', 'ë Œê³ ì¿  ì¿„ì¥¬ë¡œì˜ ë§ˆì§€ë§‰ ë¯¸ì†Œ. ê·¸ì˜ ì˜ì§€ê°€ ë‚´ ë§ˆìŒë„ ëœ¨ê²ê²Œ í–ˆì–´.')">ê·€ë©¸ì˜ì¹¼ë‚ </div>
                    
                    <div class="grimoire bg-emerald-900 border-l-4 border-emerald-700 text-emerald-100 h-[170px]" 
                         onclick="openGrimoire('ì£¼ìˆ íšŒì „', 'ê°€ì¥ ê°€ì§€ê³  ì‹¶ì€ ì˜ì—­ ì „ê°œëŠ”?', 'ë¬´ëŸ‰ê³µì²˜. ì••ë„ì ì¸ ì •ë³´ëŸ‰ìœ¼ë¡œ ì ì„ ë¬´ë ¥í™”í•˜ëŠ” ì—°ì¶œì´ ìµœê³ ì•¼.')">ì£¼ìˆ íšŒì „</div>
                    
                    <div class="grimoire bg-amber-900 border-l-4 border-amber-700 text-amber-100 h-[210px]" 
                         onclick="openGrimoire('í•˜ì´í!!', 'ë‚´ ì‚¶ì„ ë°”ê¾¼ í•œ ë¬¸ì¥ì€?', 'ë¬´ìŠ¨ ì¼ì´ ìˆì–´ë„ ê³µì€ ë°˜ë“œì‹œ ì˜¬ë¼ì˜¨ë‹¤. ëê¹Œì§€ í¬ê¸°í•˜ì§€ ì•ŠëŠ” ì—°ê²°ì˜ í˜.')">í•˜ì´í!!</div>
                    
                    <div class="grimoire bg-indigo-900 border-l-4 border-indigo-700 text-indigo-100 h-[185px]" 
                         onclick="openGrimoire('ìµœì• ì˜ ì•„ì´', 'ì‘í’ˆ ì† ê°€ì¥ ì¶©ê²©ì ì¸ ë§ˆë²•ì€?', 'ê±°ì§“ë§ì€ ê°€ì¥ ì§€ë…í•˜ê³  ì•„ë¦„ë‹¤ìš´ ë§ˆë²•ì´ë‹¤. ì•„ì´ì˜ ëˆˆë¹›ì´ ìŠí˜€ì§€ì§€ ì•Šì•„.')">ìµœì• ì˜ì•„ì´</div>
                    
                    <div class="grimoire bg-slate-900 border-l-4 border-slate-700 text-slate-100 h-[175px]" 
                         onclick="openGrimoire('ìŠ¤íŒŒì´íŒ¨ë°€ë¦¬', 'ì•„ëƒê°€ ë‹¹ì‹ ì˜ ë§ˆìŒì„ ì½ëŠ”ë‹¤ë©´?', 'ë‚´ ë•í›„ ê°™ì€ ë§ˆìŒì„ ë“¤í‚¤ê³  ì•„ëƒê°€ ë‹¹í™©í•´í•˜ëŠ” ëª¨ìŠµì´ ìƒìƒë¼ì„œ ì›ƒìŒì´ ë‚˜.')">ìŠ¤íŒŒì´íŒ¨ë°€ë¦¬</div>
                </div>
                <!-- ì„ ë°˜ ë°”ë‹¥ -->
                <div class="shelf-plate w-full"></div>
            </div>
        </section>
    </main>

    <!-- ëª¨ë‹¬: ë§ˆë„ì„œ í¼ì¹˜ê¸° -->
    <div id="modalOverlay" class="modal-blur fixed inset-0 flex items-center justify-center p-4" onclick="closeGrimoire()">
        <div id="grimoireContent" class="bg-[#f4eee0] text-[#2d241e] w-full max-w-lg p-10 rounded-r-3xl rounded-l-md shadow-2xl relative book-open-anim border-l-[12px] border-amber-900" onclick="event.stopPropagation()">
            <div class="absolute top-4 right-6 text-2xl cursor-pointer opacity-50 hover:opacity-100" onclick="closeGrimoire()">Ã—</div>
            
            <h3 id="m-title" class="text-2xl font-bold mb-4 font-serif text-amber-900"></h3>
            
            <div class="h-px bg-amber-900/20 mb-8"></div>
            
            <div class="mb-8">
                <span class="text-xs uppercase tracking-widest text-amber-900/40 font-bold block mb-2">The Sealed Question</span>
                <div class="text-lg font-bold border-l-2 border-amber-700/30 pl-4 py-1 italic">
                    <span class="text-amber-800/60 mr-2">Q.</span>
                    <span id="m-question"></span>
                </div>
            </div>

            <div>
                <span class="text-xs uppercase tracking-widest text-amber-900/40 font-bold block mb-2">My Arcane Record</span>
                <div class="text-lg leading-relaxed font-serif pl-4">
                    <span class="text-amber-800/60 font-bold mr-2">A.</span>
                    <span id="m-body"></span>
                </div>
            </div>

            <div class="mt-12 pt-6 border-t border-amber-900/10 flex justify-between items-center text-xs text-amber-900/40 font-bold">
                <span>Arcane Memory #024</span>
                <span id="m-date">2026.02.13</span>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬: ê¸°ë¡ ì‘ì„± -->
    <div id="writeModal" class="modal-blur fixed inset-0 flex items-center justify-center p-4" onclick="closeWriteModal()">
        <div class="bg-gray-900 border border-purple-500/30 w-full max-w-md p-8 rounded-3xl shadow-2xl" onclick="event.stopPropagation()">
            <h3 class="text-2xl font-bold text-yellow-400 mb-2">ğŸ“– ìƒˆë¡œìš´ ê¸°ë¡ ë´‰ì¸</h3>
            <p id="write-q-display" class="text-purple-300 text-sm mb-6"></p>
            
            <div class="mb-4">
                <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider">Title (Anime Name)</label>
                <input id="input-title" type="text" placeholder="ì˜ˆ: ì¥ì†¡ì˜ í”„ë¦¬ë Œ" class="w-full bg-gray-800 border border-purple-500/20 rounded-xl px-4 py-2 focus:outline-none focus:border-purple-500 text-white">
            </div>

            <div class="mb-6 relative">
                <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider">Your Answer</label>
                <textarea id="input-answer" rows="4" placeholder="ë‹¹ì‹ ì˜ ìƒê°ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”..." class="w-full bg-gray-800 border border-purple-500/20 rounded-xl px-4 py-2 focus:outline-none focus:border-purple-500 text-white"></textarea>
                <button onclick="refineWithAi()" class="absolute bottom-3 right-3 text-xs bg-purple-600/40 hover:bg-purple-600 text-white px-3 py-1 rounded-full transition-all flex items-center gap-1">
                    <span id="refine-text">âœ¨ AI ë§ˆë²• ë³€í™˜</span>
                </button>
            </div>

            <div class="flex gap-3">
                <button onclick="saveRecord()" class="flex-1 bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 rounded-xl transition-all">
                    ê¸°ë¡ ë´‰ì¸ ì™„ë£Œ
                </button>
                <button onclick="closeWriteModal()" class="px-6 py-3 rounded-xl bg-gray-800 text-gray-400 font-bold">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "";
        let currentQuestion = "ì¥ì†¡ì˜ í”„ë¦¬ë Œì—ì„œ ë‹¹ì‹ ì´ ê°€ì¥ ë´‰ì¸í•´ë‘ê³  ì‹¶ì€ ê¸°ì–µì€ ë¬´ì—‡ì¸ê°€ìš”?";
        let records = [];

        // --- Gemini API ë§ˆë²• í•¨ìˆ˜ ---
        async function callGemini(prompt, systemInstruction = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: systemInstruction ? { parts: [{ text: systemInstruction }] } : undefined
            };

            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    return result.candidates?.[0]?.content?.parts?.[0]?.text || "ë§ˆë²•ì´ ì ì‹œ ë¶ˆë°œë˜ì—ˆìŠµë‹ˆë‹¤.";
                } catch (error) {
                    const delay = Math.pow(2, i) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            return "ë§ˆë²•ì˜ íë¦„ì´ ë¶ˆì•ˆì •í•©ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
        }

        // 1. âœ¨ AI ì§ˆë¬¸ ìƒì„±
        async function generateAiQuestion() {
            const btn = document.getElementById('gen-question-btn');
            const btnText = document.getElementById('btn-text');
            btn.disabled = true;
            btnText.innerHTML = `<div class="flex items-center gap-2"><div class="loading-spinner"></div> ë§ˆë ¥ ì¶”ì¶œ ì¤‘...</div>`;

            const prompt = "ë‹¤ì–‘í•œ ìœ ëª… ì• ë‹ˆë©”ì´ì…˜(ìµœì‹  ìœ í–‰ í¬í•¨)ì„ ì£¼ì œë¡œ, ì‚¬ìš©ìê°€ ìì‹ ì˜ ì² í•™ì´ë‚˜ ê°ìƒì„ ê¹Šê²Œ ì ì„ ìˆ˜ ìˆëŠ” í¥ë¯¸ë¡œìš´ ì§ˆë¬¸ì„ 1ê°œ ë§Œë“¤ì–´ì¤˜. ì§ˆë¬¸ì€ ë¶€ë“œëŸ½ê³  ì‹ ë¹„ë¡œìš´ ë§ˆë²•ì‚¬ ì»¨ì…‰ì˜ ë¬¸ì²´ë¡œ ì‘ì„±í•˜ê³ , í•œ ë¬¸ì¥ìœ¼ë¡œ ëë‚´ì¤˜.";
            const systemPrompt = "ë„ˆëŠ” ì „ì„¤ì ì¸ ë§ˆë²• ì„œì¬ì˜ ì‚¬ì„œì•¼. ì• ë‹ˆë©”ì´ì…˜ ë•í›„ë“¤ì„ ìœ„í•´ ê¹Šì´ ìˆëŠ” ì§ˆë¬¸ì„ ë˜ì ¸ì•¼ í•´.";
            
            const newQ = await callGemini(prompt, systemPrompt);
            currentQuestion = newQ.replace(/"/g, '');
            document.getElementById('current-question-display').innerText = currentQuestion;
            
            btn.disabled = false;
            btnText.innerText = "âœ¨ ë§ˆë ¥ ì¶©ì „ (AI ì§ˆë¬¸ ìƒì„±)";
            showToast("âœ¨ ìƒˆë¡œìš´ ìš´ëª…ì˜ ì§ˆë¬¸ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤.");
        }

        // 2. âœ¨ AI ë§ˆë²• ë¬¸ì²´ ë³€í™˜ (Refine)
        async function refineWithAi() {
            const answer = document.getElementById('input-answer').value;
            const refineText = document.getElementById('refine-text');
            if (!answer) return showToast("ë¨¼ì € ë‹µë³€ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”.");

            refineText.innerText = "âœ¨ ë³€í™˜ ì¤‘...";
            
            const prompt = `ì‚¬ìš©ìì˜ ë‹µë³€: "${answer}"\n\nìœ„ ë‹µë³€ì˜ ë‚´ìš©ì€ ìœ ì§€í•˜ë©´ì„œ, ì¤‘ì„¸ íŒíƒ€ì§€ ë§ˆë²• ì„œì ì´ë‚˜ ê³ ëŒ€ ë§ˆë„ì„œì— ì íŒ ì‚¬ìœ ì²˜ëŸ¼ ì‹ ë¹„ë¡­ê³  ìš°ì•„í•œ ë¬¸ì²´ë¡œ ë‹¤ë“¬ì–´ì¤˜. 3ë¬¸ì¥ ì´ë‚´ë¡œ ì§§ê³  ê°•ë ¥í•˜ê²Œ ì‘ì„±í•´ì¤˜.`;
            const systemPrompt = "ë„ˆëŠ” í‰ë²”í•œ ê¸€ì„ ì‹ ë¹„ë¡œìš´ ë§ˆë„ì„œì˜ ë¬¸ì¥ìœ¼ë¡œ ë°”ê¾¸ëŠ” ê³ ëŒ€ ëŒ€ë§ˆë²•ì‚¬ì•¼.";

            const refined = await callGemini(prompt, systemPrompt);
            document.getElementById('input-answer').value = refined.trim();
            refineText.innerText = "âœ¨ AI ë§ˆë²• ë³€í™˜";
            showToast("âœ¨ ë¬¸ì¥ì— ë§ˆë ¥ì´ ê¹ƒë“¤ì—ˆìŠµë‹ˆë‹¤.");
        }

        // 3. âœ¨ ìš´ëª…ì˜ ìˆ˜ì •êµ¬ìŠ¬ (ì¶”ì²œ)
        async function getAiRecommendation() {
            showToast("ğŸ”® ìˆ˜ì •êµ¬ìŠ¬ì´ ë‹¹ì‹ ì˜ ê¸°ë¡ì„ ì½ê³  ìˆìŠµë‹ˆë‹¤...");
            
            const currentBooks = Array.from(document.querySelectorAll('.grimoire')).map(el => el.innerText).join(', ');
            const prompt = `ì‚¬ìš©ìì˜ í˜„ì¬ ì„œì¬ì— ìˆëŠ” ì• ë‹ˆë©”ì´ì…˜ë“¤: [${currentBooks}]\n\nì´ ì·¨í–¥ì„ ë¶„ì„í•´ì„œ, ì‚¬ìš©ìê°€ ì¢‹ì•„í•  ë§Œí•œ ë˜ ë‹¤ë¥¸ ì• ë‹ˆë©”ì´ì…˜ 1ê°œë¥¼ ì¶”ì²œí•´ì¤˜. ì™œ ì¶”ì²œí•˜ëŠ”ì§€ ê·¸ ì´ìœ ë¥¼ ë§ˆë²•ì‚¬ê°€ ì˜ˆì–¸í•˜ë“¯ ì‹ ë¹„ë¡­ê²Œ í•œ ë¬¸ì¥ìœ¼ë¡œ ë§í•´ì¤˜.`;
            
            const recommendation = await callGemini(prompt, "ë„ˆëŠ” ë¯¸ë˜ë¥¼ ë³´ëŠ” ì ìˆ ì‚¬ì•¼.");
            openGrimoire('ìš´ëª…ì˜ ì˜ˆì–¸', 'ë‹¹ì‹ ì˜ ì˜í˜¼ì´ ë‹¤ìŒìœ¼ë¡œ ë§ˆì£¼í•  ì„¸ê³„ëŠ”?', recommendation);
        }

        // --- UI ì œì–´ í•¨ìˆ˜ ---
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 3000);
        }

        function openGrimoire(title, question, answer) {
            document.getElementById('m-title').innerText = "ğŸ“– " + title;
            document.getElementById('m-question').innerText = question;
            document.getElementById('m-body').innerText = answer;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        function closeGrimoire() {
            document.getElementById('modalOverlay').style.display = 'none';
        }

        function openWriteModal() {
            document.getElementById('write-q-display').innerText = `Q. ${currentQuestion}`;
            document.getElementById('writeModal').style.display = 'flex';
        }

        function closeWriteModal() {
            document.getElementById('writeModal').style.display = 'none';
            document.getElementById('input-title').value = '';
            document.getElementById('input-answer').value = '';
        }

        function saveRecord() {
            const title = document.getElementById('input-title').value;
            const answer = document.getElementById('input-answer').value;

            if (!title || !answer) return showToast("ì œëª©ê³¼ ë‹µë³€ì„ ëª¨ë‘ ì±„ì›Œì£¼ì„¸ìš”.");

            // ìƒˆë¡œìš´ ì±… ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
            const colors = ['bg-purple-900', 'bg-indigo-900', 'bg-rose-900', 'bg-cyan-900', 'bg-emerald-900'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            const randomHeight = Math.floor(Math.random() * 40) + 160;

            const newBook = document.createElement('div');
            newBook.className = `grimoire ${randomColor} border-l-4 border-opacity-50 text-white`;
            newBook.style.height = `${randomHeight}px`;
            newBook.innerText = title;
            newBook.onclick = () => openGrimoire(title, currentQuestion, answer);

            document.getElementById('bookshelf').appendChild(newBook);
            
            // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            const count = document.querySelectorAll('.grimoire').length;
            document.getElementById('book-count').innerText = `${count}ê¶Œì˜ ê¸°ë¡`;

            showToast("âœ¨ ìƒˆë¡œìš´ ë§ˆë„ì„œê°€ ì„œì¬ì— ë´‰ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
            closeWriteModal();
        }
    </script>
</body>
</html>